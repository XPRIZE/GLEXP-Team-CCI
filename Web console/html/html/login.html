<html>
   <head>
      <title>Console - Login</title>
      <!--
        <link rel="stylesheet" href="includes/webix/webix.css" type="text/css">
        <script src="includes/webix/webix.js"></script>
      -->
      <link rel="stylesheet" href="skins/webix.css" type="text/css">
      <script src="includes/jquery.js"></script>
      <script src="includes/webix/webix.js"></script>
      <script src="skins/skin.js"></script>
      <script src="js/classes/fake_post.js"></script>

      <script src="includes/sha512.js"></script>
      <script src="js/branding.js"></script>
      <style>
         #login {
             width: 302px;
             margin: auto;
             overflow: hidden;
         }

         h1, h2, h3, h4 {
             text-align: center;
             width: 100%;
         }

         .toolbarCenterLabel {
             font-size: 19px;
             line-height: 42px;
             text-align: center;
             width: 100%;
             margin: 0;
             padding: 0
         }

      </style>
   </head>
   <body>
      <div>
         <script>

            function initCaps(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }
            var header = {
                view: "toolbar",
                height: 55,
                autoWidth: true,
                cols: [
                    {},
                    {
                        view: "label",
                        template: "<p class='toolbarCenterLabel'>Console Login</p>"
                    },
                    {}
                ]
            };
            var loginCont = {
                type: "space", rows: [
                    header,
                    {},
                    {
                        cols: [
                            {},
                            {
                                id: "loginForm",
                                view: "form", scroll: false, elements: [
                                    {name: "username", view: "text", value: '', label: "Username"},
                                    {
                                        name: "password", view: "text", type: 'password', value: '', label: "Password",
                                        on: {
                                            onKeyPress: function (e) {
                                                if (e == 13) {
                                                    $$(this).blur();
                                                    login();
                                                }
                                            }
                                        }
                                    },
                                    {
                                        id: "loginError",
                                        view: "label",
                                        label: "",
                                        align: "center",
                                        css: {"color": "red", "transition": "0.5s"},
                                        height: 0
                                    },
                                    {
                                        margin: 10, cols: [
                                            {},
                                            {
                                                view: "button", value: "Register", on: {
                                                    onItemClick: function () {
                                                        window.location.href = "register.php";
                                                    }
                                                }
                                            },
                                            {
                                                view: "button", value: "Login", id: "loginButton", type: "form",
                                                on: {
                                                    onItemClick: function () {
                                                        login();
                                                    }
                                                }
                                            },
                                        ]
                                    }
                                ]
                            },
                            {},
                        ]
                    },
                    {},
                    {},
                    {},
                    {},
                    {},
                    {},
                ]
            };
            $(document).ready(function () {
                let errorMessage = "{ERROR_MESSAGE}";
                if (errorMessage) {
                   webix.message(errorMessage);
                }
                webix.ui(loginCont);
            })

            function login() {
                var data = $$("loginForm").getValues();
                var post = {};
                post.password = data.password;
                post.username = data.username;
                console.log(this);
                new fake_post("php/process/login.php", post);
            }
            function blink(elem, num) {
                var val = elem.getValue();
                var i = 0;
                var blinkFunc = function () {
                    i++;
                    if (i > (num * 2)) {
                        window.clearInterval(blinkInt);
                    } else {
                        if (i % 2) {
                            elem.setValue("");
                            elem.refresh();
                        } else {
                            elem.setValue(val);
                            elem.refresh();
                        }
                    }
                };
                blinkFunc();
                var blinkInt = window.setInterval(blinkFunc, 100);
            }
         </script>
      </div>
   </body>
</html>
